# Analysing Malicious Documents

### General Approach to Document Analysis (SANS DFIR Approach)

1. Examine the document for anomalies, such as risky tags, scripts, or other anomalous aspects.
2. Locate embedded code, such as shellcode, VBA macros, JavaScript or other suspicious objects.
3. Extract suspicious code or object from the file.
4. If relevant, deobfuscate and examine JavaScript or macro code.
5. If relevant, disassemble and/or debug shellcode. 
6. Understand the next steps in the infection chain. 

## PDF


## Office Documents

### oledump

oledump.py is a program to analyze OLE files (Compound File Binary Format). These files contain streams of data. oledump allows you to analyze these streams. Will not work on new file formats such as docx, xlsx, etc.

Command | Description
---- | ----
oledump.py filename | List all OLE2 streams present
oledump.py -s streamnumber -v filename | Extract macros stored inside stream number
oledump.py -M filename | Extract metadata from file
oledump.py -s streamnumber -v filename \| base64dump.py | Extract base64 strings from file

### olevba

olevba is a script to parse OLE and OpenXML files such as MS Office documents (e.g. Word, Excel), to detect VBA Macros, extract their source code in clear text, and detect security-related patterns such as auto-executable macros, suspicious VBA keywords used by malware, anti-sandboxing and anti-virtualization techniques, and potential IOCs (IP addresses, URLs, executable filenames, etc).

Command | Description
---- | ----
olevba.py filename | List all OLE2 streams present in file
olevba.py filename --reveal | Scan a single file, showing the macro source code with VBA strings deobfuscated

#### References
https://digital-forensics.sans.org/media/analyzing-malicious-document-files.pdf
https://blog.didierstevens.com/programs/oledump-py/
https://zeltser.com/analyzing-malicious-documents/
https://github.com/decalage2/oletools/wiki/olevba
